# 重定向功能修复测试说明

## 修复内容
修复了接口管理页面中重定向相关功能缺失的问题：
1. **重定向目标URL设置** - 在选择"重定向"或"URL重定向"处理方式时显示目标URL输入框
2. **自定义请求头设置** - 在重定向模式下显示自定义请求头的动态表单

## 测试步骤

### 1. 创建重定向接口测试
1. 打开接口管理页面
2. 点击"添加接口"按钮
3. 填写基本信息：
   - 接口名称：测试重定向
   - URL匹配规则：https://example.com/test
   - 处理方式：选择"重定向"
4. 验证是否显示以下字段：
   - ✅ 重定向目标URL输入框
   - ✅ 自定义请求头设置区域
5. 填写重定向目标URL：https://www.baidu.com
6. 添加自定义请求头：
   - Authorization: Bearer test123
   - X-Custom-Header: test-value
7. 保存接口

### 2. 编辑现有重定向接口测试
1. 找到已有的重定向类型接口
2. 点击编辑按钮
3. 验证是否正确显示：
   - ✅ 重定向目标URL字段及其现有值
   - ✅ 自定义请求头列表及其现有值
4. 修改重定向目标URL和自定义请求头
5. 保存修改

### 3. URL重定向测试
1. 创建新接口，选择"URL重定向"处理方式
2. 验证是否同样显示：
   - ✅ 重定向目标URL设置
   - ✅ 自定义请求头设置

## 技术细节

### 修复的问题
- 表单条件渲染中缺少对 `redirect` 和 `url_redirect` 类型的处理
- 缺少重定向目标URL的表单字段
- 缺少自定义请求头的动态表单项

### 修复的代码位置
- `whistle.mock-plugin/ui/src/pages/InterfaceManagement.js`
  - 在表单条件渲染中添加了重定向类型的处理逻辑
  - 添加了 `targetUrl` 表单字段和验证规则
  - 添加了 `headerItems` 动态表单列表
  - 在 `handleAddInterface` 中添加了 `headerItems` 初始化

### 数据处理逻辑
- **编辑时**：将 `customHeaders` 对象转换为 `headerItems` 数组用于表单显示
- **提交时**：将 `headerItems` 数组转换回 `customHeaders` 对象用于存储
- **显示时**：在表格中正确显示自定义请求头的数量和内容

## 预期结果
修复后，用户在创建或编辑重定向类型的接口时，能够：
1. 正常设置重定向目标URL
2. 正常添加、编辑、删除自定义请求头
3. 在接口列表中正确显示重定向配置信息 

# 请求入参匹配功能测试说明

## 功能概述
在接口管理中新增了请求入参匹配功能，可以根据请求参数的值来决定返回哪个接口的响应。支持以下特性：

- **嵌套属性访问**：支持如 `a.b.c` 的深层属性路径
- **多种匹配类型**：精确匹配、包含匹配、正则表达式匹配
- **多规则组合**：可以设置多个参数匹配规则，所有规则都满足才会命中接口
- **参数来源多样**：支持URL查询参数、POST请求体参数、路径参数

## 测试场景

### 1. 基础参数匹配测试

#### 创建测试接口
1. 打开接口管理页面
2. 点击"添加接口"
3. 填写基本信息：
   - 接口名称：用户权限检查
   - URL匹配规则：/api/users
   - 处理方式：模拟响应
   - 请求方法：POST

4. 添加参数匹配规则：
   - 参数路径：`userId`
   - 期望值：`123`
   - 匹配类型：精确匹配

5. 设置响应内容：
```json
{
  "code": 0,
  "message": "管理员用户",
  "data": {
    "userId": 123,
    "role": "admin",
    "permissions": ["read", "write", "delete"]
  }
}
```

#### 测试请求
- **命中请求**：`POST /api/users` with body `{"userId": "123"}`
- **不命中请求**：`POST /api/users` with body `{"userId": "456"}`

### 2. 嵌套属性路径测试

#### 创建测试接口
1. 接口名称：用户角色检查
2. URL匹配规则：/api/user/profile
3. 参数匹配规则：
   - 参数路径：`user.role.type`
   - 期望值：`premium`
   - 匹配类型：精确匹配

#### 测试请求
- **命中请求**：
```json
POST /api/user/profile
{
  "user": {
    "id": 1,
    "role": {
      "type": "premium",
      "level": 5
    }
  }
}
```

- **不命中请求**：
```json
POST /api/user/profile
{
  "user": {
    "id": 1,
    "role": {
      "type": "basic",
      "level": 1
    }
  }
}
```

### 3. 多种匹配类型测试

#### 精确匹配
- 参数路径：`status`
- 期望值：`active`
- 匹配类型：精确匹配

#### 包含匹配
- 参数路径：`description`
- 期望值：`test`
- 匹配类型：包含

#### 正则表达式匹配
- 参数路径：`phone`
- 期望值：`^1[3-9]\d{9}$`
- 匹配类型：正则

### 4. 多规则组合测试

创建接口设置多个参数匹配规则：
1. 参数路径：`type` / 期望值：`order` / 匹配类型：精确匹配
2. 参数路径：`status` / 期望值：`paid` / 匹配类型：精确匹配
3. 参数路径：`amount` / 期望值：`\d{1,6}` / 匹配类型：正则

只有当所有三个条件都满足时，才会命中该接口。

### 5. 同URL多接口区分测试

创建两个相同URL但不同参数匹配的接口：

#### 接口1：VIP用户订单
- URL：/api/order/list
- 参数匹配：`userType` = `vip`
- 响应：VIP用户订单列表

#### 接口2：普通用户订单  
- URL：/api/order/list
- 参数匹配：`userType` = `normal`
- 响应：普通用户订单列表

#### 接口3：默认订单（无参数匹配）
- URL：/api/order/list
- 无参数匹配规则
- 响应：默认订单列表

测试不同的请求，验证能否正确区分并返回对应的响应。

## 前端界面测试

### 1. 参数匹配表单测试
- 验证能否正确添加、编辑、删除参数匹配规则
- 验证表单验证规则是否生效（参数路径格式验证）
- 验证匹配类型选择是否正常

### 2. 接口列表显示测试
- 验证参数匹配列是否正确显示规则数量
- 验证鼠标悬停是否显示详细的匹配规则信息
- 验证只有模拟响应类型的接口才显示参数匹配信息

### 3. 数据持久化测试
- 创建带参数匹配的接口，刷新页面验证数据是否保存
- 编辑已有接口的参数匹配规则，验证修改是否生效
- 删除参数匹配规则，验证是否正确清除

## 预期结果

1. **参数匹配成功**：返回对应接口的响应内容
2. **参数匹配失败**：继续查找其他匹配的接口，如无其他接口则透传请求
3. **多个匹配**：返回第一个完全匹配（URL+参数）的接口响应
4. **回退机制**：如果有URL匹配但无参数匹配的接口，作为最后的回退选项

## 错误处理

1. **参数路径不存在**：视为匹配失败
2. **正则表达式无效**：记录错误日志，视为匹配失败  
3. **参数值类型转换**：自动转换为字符串进行比较
4. **嵌套路径访问错误**：安全处理，返回undefined

## 日志记录

系统会记录以下日志信息：
- 参数匹配检查过程
- 匹配成功/失败的详细原因
- 接口选择的决策过程
- 参数匹配失败时的回退逻辑 

# 功能模块卡片点击优化测试说明

## 优化内容
优化了功能模块卡片的交互体验，实现以下功能：

1. **点击卡片跳转**：点击功能模块卡片的任意区域（除开关和操作按钮外）可以直接跳转到该功能的接口管理界面
2. **开关功能保持**：点击右上角的开关仍然可以正常启用/禁用功能模块，不会触发跳转
3. **操作按钮独立**：底部的管理接口、编辑、删除、导出等操作按钮保持独立功能，不会触发卡片跳转

## 技术实现

### 事件处理优化
- **卡片点击事件**：为整个卡片添加 `onClick` 处理，检测点击目标并智能跳转
- **事件冒泡控制**：在开关和操作按钮上添加 `stopPropagation()` 阻止事件冒泡
- **点击区域检测**：通过 `closest()` 方法检测点击目标，避免误触

### 视觉优化
- **鼠标指针**：卡片添加 `cursor: pointer` 提示可点击
- **悬停效果**：增强悬停时的阴影和变换效果
- **渐变遮罩**：添加微妙的蓝色渐变遮罩提示交互
- **层级管理**：确保卡片内容和操作按钮在渐变层之上

## 测试步骤

### 1. 卡片点击跳转测试
1. 打开模拟数据管理页面
2. 点击任意功能模块卡片的以下区域：
   - 功能名称区域 ✅
   - 功能描述区域 ✅  
   - 统计信息区域（接口数量、创建日期） ✅
3. 验证是否正确跳转到该功能的接口管理界面

### 2. 开关功能独立性测试
1. 点击功能卡片右上角的启用/禁用开关
2. 验证：
   - ✅ 开关状态正确切换
   - ✅ 不会触发页面跳转
   - ✅ 显示相应的成功/失败提示

### 3. 操作按钮独立性测试
1. 依次点击卡片底部的操作按钮：
   - 📊 管理接口：直接跳转到接口管理
   - ✏️ 编辑功能：打开编辑模态框
   - 🗑️ 删除功能：显示删除确认
   - 📤 导出配置：下载配置文件
2. 验证每个操作都正常执行，且不会触发卡片跳转

### 4. 视觉反馈测试
1. 鼠标悬停在功能卡片上：
   - ✅ 鼠标指针变为手形
   - ✅ 卡片向上浮动
   - ✅ 阴影增强
   - ✅ 出现微妙的蓝色渐变
2. 点击卡片时有轻微的按下效果

## 预期结果

1. **用户体验提升**：用户可以通过点击卡片快速进入接口管理，减少操作步骤
2. **功能完整性**：所有原有功能（开关、编辑、删除等）保持正常工作
3. **视觉一致性**：交互反馈清晰，符合用户直觉
4. **无副作用**：不影响现有的任何功能逻辑

## 错误处理

- **点击检测**：通过精确的DOM元素检测避免误触
- **事件隔离**：每个交互区域的事件处理相互独立
- **兼容性**：支持各种点击方式（鼠标、触摸等）

该优化大大提升了用户在功能模块管理页面的操作效率，使得从功能模块快速跳转到接口管理变得更加便捷。 
---
description: 
globs: 
alwaysApply: true
---
# Whistle.mock-plugins 项目目录功能列表

## 项目概述


Whistle.mock-plugins 是一个 Whistle 插件，用于快速创建 API 模拟数据，提供友好的用户界面和丰富的功能。主要功能包括接口模拟、URL 重定向、文件代理等，支持功能模块管理和规则匹配。

## 目录结构与功能

### 根目录文件

| 文件/目录              | 功能描述                                      |
| --------------------- | -------------------------------------------- |
| `package.json`        | 项目配置文件，定义依赖、脚本和插件信息          |
| `initialize.js`       | 插件初始化入口，负责初始化数据目录和管理器       |
| `rules.txt`           | Whistle 规则示例和使用说明                     |
| `index.html`          | 插件UI入口页面                                |
| `webpack.config.js`   | Webpack 构建配置                              |
| `API.md`              | API 文档                                      |
| `README.md`           | 项目说明文档                                  |

### lib 目录 - 插件核心功能实现

| 文件                | 功能描述                                      |
| ------------------- | -------------------------------------------- |
| `index.js`          | 插件主入口，导出 server、uiServer 和 rulesServer |
| `server.js`         | 请求处理服务器，负责模拟响应和代理实现           |
| `rules-server.js`   | 规则匹配服务器，处理 Whistle 规则匹配和转发      |
| `ui-server.js`      | UI 服务器，处理界面相关请求                     |
| `ruleManager.js`    | 规则管理器，处理规则匹配和转发逻辑               |
| `dataManager.js`    | 数据管理器，负责功能模块和接口配置的存储和检索    |
| `storage.js`        | 存储工具，定义数据存储路径和基本操作             |
| `models.js`         | 数据模型定义                                   |

### lib/routes 目录 - 后端路由处理

| 文件               | 功能描述                                      |
| ------------------ | -------------------------------------------- |
| `features.js`      | 功能模块管理相关 API 路由处理                  |
| `interfaces.js`    | 接口配置管理相关 API 路由处理                  |
| `proxy.js`         | 代理操作相关 API 路由处理                      |

### app 目录 - 前端应用资源

| 目录               | 功能描述                                      |
| ------------------ | -------------------------------------------- |
| `cgi-bin/`         | 前端 CGI 接口实现                             |
| `public/`          | 公共资源文件                                  |
| `util/`            | 前端工具函数                                  |

### app/cgi-bin 目录 - 前端接口实现

| 文件                 | 功能描述                                    |
| ------------------- | ------------------------------------------ |
| `index.js`          | CGI 接口入口                                |
| `features.js`       | 功能模块管理接口实现                         |
| `interfaces.js`     | 接口配置管理接口实现                         |
| `logs.js`           | 日志查询接口实现                             |
| `test-interface.js` | 接口测试功能实现                             |
| `url-redirects.js`  | URL 重定向功能相关接口实现                    |

### ui 目录 - 前端 UI 实现

| 目录              | 功能描述                                      |
| ----------------- | -------------------------------------------- |
| `src/`            | 前端源代码                                    |

### ui/src 目录 - 前端源码

| 文件/目录           | 功能描述                                     |
| ------------------ | ------------------------------------------- |
| `index.js`         | React 应用入口                               |
| `App.js`           | 应用主组件                                   |
| `App.css`          | 应用主样式                                   |
| `components/`      | UI 组件                                      |
| `pages/`           | 页面组件                                     |
| `services/`        | 前端服务，API 调用封装                        |
| `styles/`          | 样式文件                                     |

### 其他目录

| 目录               | 功能描述                                      |
| ------------------ | -------------------------------------------- |
| `test/`            | 测试文件                                     |
| `public/`          | 静态资源文件                                 |
| `node_modules/`    | 依赖库                                       |
| `.vscode/`         | VSCode 配置                                  |

## 核心功能模块

### 1. 规则匹配和转发

- `rules-server.js`: 负责匹配 Whistle 规则，判断是否将请求转发到插件
- `ruleManager.js`: 处理规则匹配和转发逻辑，实现不同类型的响应处理

### 2. 请求处理

- `server.js`: 主要的请求处理服务，包含以下功能:
  - 数据模板响应
  - URL 重定向
  - 文件代理
  - 请求转发

### 3. 数据管理

- `dataManager.js`: 管理功能模块和接口配置
  - 功能模块的增删改查
  - 接口配置的增删改查
  - 数据持久化
  - 请求日志记录

### 4. 前端界面

- `ui/`: React 实现的前端界面
  - 功能模块管理
  - 接口配置管理
  - 接口测试
  - 日志查看

## 关键流程

1. **规则匹配流程**：
   - Whistle 接收到请求，根据规则调用 `rules-server.js`
   - `rules-server.js` 检查请求是否匹配接口配置
   - 匹配成功时，返回转发规则，将请求转发到插件

2. **请求处理流程**：
   - `server.js` 接收到转发的请求
   - 调用 `ruleManager.handleRequest` 处理请求
   - 根据接口配置的代理类型，执行相应的处理逻辑
   - 对于 URL 重定向，设置 Location 头和 302 状态码
   - 对于模板数据，使用 Mock.js 生成数据并返回
   - 对于文件代理，读取文件内容并返回

3. **数据管理流程**：
   - 通过 UI 界面创建/修改功能模块和接口配置
   - `dataManager.js` 负责将配置持久化到文件系统
   - 规则匹配时加载和检索这些配置


这个修改将使URL重定向功能正常工作，同时保持两种配置系统的独立性，提供更灵活的使用方式。 
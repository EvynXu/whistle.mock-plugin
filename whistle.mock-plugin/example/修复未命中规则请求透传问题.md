# 修复未命中规则请求透传问题

## 问题描述

未命中规则的请求直接返回404，而非按预期透传至原目标服务器。这会导致所有经过Whistle插件但未配置规则的请求都无法正常访问。

## 问题原因

1. 代码逻辑中，虽然添加了透传相关注释，但实际执行时仍有问题
2. 规则管理器(ruleManager)没有正确处理next回调函数
3. 关键中间件中未正确传递next参数

## 修复方案

### 1. 修正handleLegacyRequest函数说明

将原有注释从"无匹配接口，返回404"修改为"无匹配接口，记录并透传"，明确处理逻辑。

### 2. 规则管理器增强

修改`ruleManager.js`中的`handleRequest`方法：
- 添加next参数，确保可以正确透传
- 改进日志说明，清晰表明请求将被透传
- 优化未匹配情况的处理逻辑

### 3. 正确传递next回调

在server.js中更新app.use中间件：
- 将next参数传递给ruleManager.handleRequest方法
- 确保未匹配规则时能正确调用next()继续请求

## 验证方法

1. 在Whistle中添加插件规则：
   ```
   example.com whistle.mock-plugin://
   ```

2. 访问一个未在插件中配置的路径：
   ```
   http://example.com/any/path
   ```

3. 观察结果：
   - 请求应正常透传到原始服务器
   - 运行日志中应显示"未找到匹配的接口配置，请求继续"
   - 不应再出现404错误

## 技术细节

1. 透传机制依赖Express中间件链的next()调用
2. 原始URL通过x-whistle-real-url请求头保留并传递
3. 所有请求会被记录到日志中，便于调试和监控

## 注意事项

1. 此修复不影响已配置接口的匹配和处理逻辑
2. 所有透传的请求仍会在日志中记录，便于跟踪
3. 确保Whistle配置正确，否则可能导致请求循环 
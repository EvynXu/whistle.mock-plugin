# 请求透传与日志功能

## 功能说明

1. **请求透传**: 未匹配到接口规则的请求将不再被拦截并返回404，而是直接继续按照原路径请求，实现透明代理。
2. **请求日志记录**: 所有经过插件的请求都会被记录到日志中，包括被匹配的请求和透传的请求。
3. **运行日志查看**: 可以在UI界面的"运行日志"页面查看所有请求的详细日志。

## 工作原理

1. 当请求经过插件时，首先记录请求基本信息
2. 尝试匹配已配置的接口规则
3. 如果匹配成功，则按规则处理并记录匹配结果
4. 如果匹配失败，则记录未匹配状态并继续请求原目标

## 日志类型

日志系统记录了以下类型的事件：

- **plugin_request**: 所有经过插件的请求
- **matched**: 匹配到接口规则的请求
- **not_matched**: 未匹配到接口规则的请求(透传)
- **error**: 处理过程中出现错误的请求

## 日志字段说明

每条日志记录包含以下信息：

- **id**: 日志唯一标识
- **timestamp**: 时间戳
- **type**: 日志类型
- **method**: 请求方法(GET, POST等)
- **url**: 请求URL
- **path**: 请求路径
- **ruleValue**: 匹配的规则值
- **interfaceId**: 匹配到的接口ID(如果有)
- **interfaceName**: 匹配到的接口名称(如果有)
- **message**: 日志消息

## 查看日志

可以通过以下方式查看日志：

1. **UI界面**: 访问插件UI界面中的"运行日志"页面
2. **API接口**: 
   ```
   GET http://localhost:8899/cgi-bin/logs
   ```

   支持以下查询参数：
   - `type`: 日志类型
   - `keyword`: 搜索关键字
   - `page`: 页码
   - `pageSize`: 每页记录数
   - `limit`: 返回的最大记录数

## 清空日志

如果日志记录过多，可以通过以下方式清空：

1. **UI界面**: 在"运行日志"页面点击"清空日志"按钮
2. **API接口**:
   ```
   DELETE http://localhost:8899/cgi-bin/logs
   ```

## 配置建议

为了更好地使用请求透传功能，建议按以下方式配置Whistle规则：

```
# 对特定域名使用插件，未命中规则的请求会透传
example.com whistle.mock-plugin://

# 对所有请求使用插件，谨慎使用，可能影响其他请求
* whistle.mock-plugin://
```

## 注意事项

1. 请求透传功能适用于只想修改部分接口，而让其他接口保持原样的场景
2. 所有经过插件的请求都会被记录，包括透传的请求
3. 日志记录功能会定期清理旧日志，最多保留5000条记录
4. 大量请求可能导致日志文件增长较快，影响性能 